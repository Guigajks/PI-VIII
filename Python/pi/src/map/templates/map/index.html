<!-- chat/templates/chat/index.html -->
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Chat Rooms</title>

    {% load static %}
    <link rel="stylesheet" href="{% static 'map/style.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'map/bootstrap.min.css' %}" type="text/css">
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-10">
                <div class="row justify-content-center">
                    <div class="canvas">
                        <canvas id="myCanvas" width="480" height="320"></canvas>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="row">
                    <ul class="list-group"></ul>
                </div>
            </div>
        </div>
    </div>
    <script src="{% static 'map/jquery-3.3.1.min.js' %}"></script>
    <script>
        // var roomName = {{ room_name_json }};

        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");
        var x = 620;
        var y = 350;
        canvas.width = 680;
        canvas.height = 406;

        // var background = new Image();
        // background.src = "pi.jpeg";

        function drawBall() {
            ctx.beginPath();
            ctx.arc(x, y, 15, 0, Math.PI * 2);
            ctx.fillStyle = "#0095DD";
            ctx.fill();
            ctx.closePath();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // ctx.drawImage(background,0,0); 
            drawBall();
            /* x += dx;
            y += dy; */
            // console.log('oi')
        }
        // setInterval(draw, 1000);

        var chatSocket = new WebSocket(
            'ws://' + window.location.host +
            '/ws/');

        chatSocket.onmessage = function (e) {
            console.log(e)
            var data = JSON.parse(JSON.parse(e.data).message);
            console.log(data)
            x = Math.abs(data.trilateracao[0] * 20)
            y = Math.abs(data.trilateracao[1] * 20)

            draw()
            // var message = data['message'];
            // document.querySelector('#chat-log').value += (message + '\n');
        };

        // chatSocket.onclose = function(e) {
        //     console.error('Chat socket closed unexpectedly');
        // };

        // document.querySelector('#chat-message-input').focus();
        // document.querySelector('#chat-message-input').onkeyup = function(e) {
        //     if (e.keyCode === 13) {  // enter, return
        //         document.querySelector('#chat-message-submit').click();
        //     }
        // };

        // document.querySelector('#chat-message-submit').onclick = function(e) {
        //     var messageInputDom = document.querySelector('#chat-message-input');
        //     var message = messageInputDom.value;
        //     chatSocket.send(JSON.stringify({
        //         'message': message
        //     }));

        //     messageInputDom.value = '';
        // };
    </script>
</body>

</html>